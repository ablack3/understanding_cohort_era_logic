"0","cteEndDates <- sqldf::sqldf("""
"0","SELECT person_id, ingredient_concept_id, event_date, event_type,"
"0","  MAX(start_ordinal) OVER (PARTITION BY person_id, ingredient_concept_id"
"0","    ORDER BY event_date, event_type ROWS UNBOUNDED PRECEDING) AS start_ordinal,"
"0","  ROW_NUMBER() OVER (PARTITION BY person_id, ingredient_concept_id ORDER BY event_date, event_type) AS overall_ord"
"0","FROM ("
"0","    -- select the start dates, assigning a row number to each"
"0","    SELECT person_id, ingredient_concept_id, drug_sub_exposure_start_date AS event_date,"
"0","    -1 AS event_type,"
"0","    ROW_NUMBER() OVER (PARTITION BY person_id, ingredient_concept_id"
"0","        ORDER BY drug_sub_exposure_start_date) AS start_ordinal"
"0","    FROM cteFinalTarget"
"0","    UNION ALL"
"0","    -- pad the end dates by 30 to allow a grace period for overlapping ranges."
"0","    SELECT person_id, ingredient_concept_id, drug_sub_exposure_end_date + 30, 1 AS event_type, NULL"
"0","    FROM cteFinalTarget"
"0",")"")"
"2","tcltk DLL is linked to '/opt/X11/lib/libX11.6.dylib'
"
"0","cteEndDates %>% "
"0","  mutate(is_valid_end_date = (2 * start_ordinal) - overall_ord == 0)"
